<div class="system-message">
    <p>Boa Noite</p>
    <h2><?php echo $name; ?></h2>
</div>
<div class="card__container row">
    <div class="card__box shop__info col-sm-4 grid">
        <div class="card grid">
            <div class="card__header">
                <h3 class="title">Acessos</h3>
            </div>
            <div class="site__metrics">
                <span class="percent danger">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" style="fill: rgba(0, 0, 0, 1);transform: ;msFilter:;"><path d="m14 9.586-4 4-6.293-6.293-1.414 1.414L10 16.414l4-4 4.293 4.293L16 19h6v-6l-2.293 2.293z"></path></svg>
                    19,2%
                </span>
                <p>Menos que mês passado</p>
            </div>
            <h1 class="info__number mb-0">
                <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 64 64" fill="none"><path d="M16.1429 15.6429C14.8361 15.6429 13.5587 16.0304 12.4721 16.7564C11.3856 17.4824 10.5387 18.5143 10.0387 19.7216C9.53857 20.9288 9.40773 22.2573 9.66267 23.539C9.91761 24.8206 10.5469 25.9979 11.4709 26.922C12.3949 27.846 13.5722 28.4752 14.8539 28.7302C16.1355 28.9851 17.464 28.8543 18.6713 28.3542C19.8786 27.8541 20.9105 27.0073 21.6365 25.9207C22.3625 24.8342 22.75 23.5568 22.75 22.25C22.75 20.4977 22.0539 18.8171 20.8148 17.578C19.5757 16.339 17.8952 15.6429 16.1429 15.6429ZM16.1429 26.2143C15.3588 26.2143 14.5923 25.9818 13.9404 25.5462C13.2885 25.1106 12.7804 24.4914 12.4803 23.7671C12.1803 23.0427 12.1018 22.2456 12.2547 21.4766C12.4077 20.7076 12.7853 20.0012 13.3397 19.4468C13.8941 18.8924 14.6005 18.5148 15.3695 18.3619C16.1385 18.2089 16.9355 18.2874 17.6599 18.5875C18.3843 18.8875 19.0034 19.3956 19.439 20.0476C19.8746 20.6995 20.1071 21.4659 20.1071 22.25C20.1071 23.3014 19.6895 24.3097 18.946 25.0532C18.2026 25.7966 17.1943 26.2143 16.1429 26.2143ZM28.0357 40.75V39.4286C28.0357 36.9753 27.0612 34.6225 25.3265 32.8878C23.5917 31.1531 21.239 30.1786 18.7857 30.1786H13.5C11.0467 30.1786 8.69397 31.1531 6.95926 32.8878C5.22455 34.6225 4.25 36.9753 4.25 39.4286V40.75H6.89286V39.4286C6.89286 37.6762 7.58896 35.9957 8.82804 34.7566C10.0671 33.5175 11.7477 32.8214 13.5 32.8214H18.7857C20.538 32.8214 22.2186 33.5175 23.4577 34.7566C24.6967 35.9957 25.3929 37.6762 25.3929 39.4286V40.75H28.0357Z" fill="black"/><path d="M47.8572 15.6429C46.5504 15.6429 45.273 16.0304 44.1864 16.7564C43.0999 17.4824 42.253 18.5143 41.7529 19.7216C41.2529 20.9288 41.122 22.2573 41.377 23.539C41.6319 24.8206 42.2612 25.9979 43.1852 26.922C44.1092 27.846 45.2865 28.4752 46.5682 28.7302C47.8498 28.9851 49.1783 28.8543 50.3856 28.3542C51.5929 27.8541 52.6248 27.0073 53.3508 25.9207C54.0768 24.8342 54.4643 23.5568 54.4643 22.25C54.4643 20.4977 53.7682 18.8171 52.5291 17.578C51.29 16.339 49.6095 15.6429 47.8572 15.6429ZM47.8572 26.2143C47.0731 26.2143 46.3066 25.9818 45.6547 25.5462C45.0028 25.1106 44.4947 24.4914 44.1946 23.7671C43.8946 23.0427 43.8161 22.2456 43.969 21.4766C44.122 20.7076 44.4996 20.0012 45.054 19.4468C45.6084 18.8924 46.3148 18.5148 47.0838 18.3619C47.8528 18.2089 48.6498 18.2874 49.3742 18.5875C50.0986 18.8875 50.7177 19.3956 51.1533 20.0476C51.5889 20.6995 51.8214 21.4659 51.8214 22.25C51.8214 23.3014 51.4038 24.3097 50.6603 25.0532C49.9169 25.7966 48.9085 26.2143 47.8572 26.2143ZM59.75 40.75V39.4286C59.75 36.9753 58.7755 34.6225 57.0407 32.8878C55.306 31.1531 52.9533 30.1786 50.5 30.1786H45.2143C42.761 30.1786 40.4083 31.1531 38.6736 32.8878C36.9388 34.6225 35.9643 36.9753 35.9643 39.4286V40.75H38.6072V39.4286C38.6072 37.6762 39.3033 35.9957 40.5423 34.7566C41.7814 33.5175 43.462 32.8214 45.2143 32.8214H50.5C52.2523 32.8214 53.9329 33.5175 55.172 34.7566C56.411 35.9957 57.1072 37.6762 57.1072 39.4286V40.75H59.75Z" fill="black"/><rect x="24.9524" y="37.6667" width="14.0952" height="3.52381" fill="white"/><path d="M32 20.9286C30.6932 20.9286 29.4158 21.3161 28.3292 22.0421C27.2427 22.7681 26.3958 23.8 25.8958 25.0073C25.3957 26.2146 25.2648 27.543 25.5198 28.8247C25.7747 30.1064 26.404 31.2836 27.328 32.2077C28.252 33.1317 29.4293 33.761 30.711 34.0159C31.9926 34.2708 33.3211 34.14 34.5284 33.6399C35.7357 33.1398 36.7676 32.293 37.4936 31.2064C38.2196 30.1199 38.6071 28.8425 38.6071 27.5357C38.6071 25.7834 37.911 24.1028 36.6719 22.8638C35.4328 21.6247 33.7523 20.9286 32 20.9286ZM32 31.5C31.2159 31.5 30.4495 31.2675 29.7975 30.8319C29.1456 30.3963 28.6375 29.7772 28.3375 29.0528C28.0374 28.3284 27.9589 27.5313 28.1119 26.7623C28.2648 25.9933 28.6424 25.287 29.1968 24.7325C29.7512 24.1781 30.4576 23.8006 31.2266 23.6476C31.9956 23.4946 32.7927 23.5731 33.517 23.8732C34.2414 24.1732 34.8606 24.6814 35.2962 25.3333C35.7318 25.9852 35.9643 26.7517 35.9643 27.5357C35.9643 28.5871 35.5466 29.5954 34.8031 30.3389C34.0597 31.0823 33.0514 31.5 32 31.5ZM43.8928 46.0357V44.7143C43.8928 42.261 42.9183 39.9083 41.1836 38.1735C39.4489 36.4388 37.0961 35.4643 34.6428 35.4643H29.3571C26.9039 35.4643 24.5511 36.4388 22.8164 38.1735C21.0817 39.9083 20.1071 42.261 20.1071 44.7143V46.0357H22.75V44.7143C22.75 42.962 23.4461 41.2814 24.6852 40.0423C25.9242 38.8033 27.6048 38.1071 29.3571 38.1071H34.6428C36.3952 38.1071 38.0757 38.8033 39.3148 40.0423C40.5539 41.2814 41.25 42.962 41.25 44.7143V46.0357H43.8928Z" fill="black"/></svg>
                2451
            </h1>
        </div>
    </div>
    <div class="card__box shop__info col-sm-4 grid">
        <div class="card grid">
            <div class="card__header">
                <h3 class="title">Produtos Ativos</h3>
                <a href="#" class="link">Alterar Plano</a>
            </div>
            <div class="plan__metrics">
                <div class="chart-js">
                <svg xmlns="http://www.w3.org/2000/svg" width="96" height="96" viewBox="0 0 80 80" fill="none"><path d="M68.2843 68.2843C73.8784 62.6902 77.688 55.5629 79.2314 47.8036C80.7748 40.0444 79.9827 32.0017 76.9552 24.6927C73.9277 17.3836 68.8008 11.1365 62.2228 6.74122C55.6448 2.34596 47.9113 5.97283e-07 40 0L40 40L68.2843 68.2843Z" fill="#FBBC05"/><rect x="17.1429" y="17.1429" width="45.7143" height="45.7143" rx="22.8571" fill="white"/><rect x="53" y="54" width="17.1429" height="17.1429" rx="8.57143" fill="#FBBC05"/><rect x="31" width="17.1429" height="17.1429" rx="8.57143" fill="#FBBC05"/></svg>
                </div>
                <div class="text line-height align-self-end">
                    <div class="d-flex align-items-baseline mb-3">
                        <h1 class="fw-semibold mb-0 mx-2">7</h1>
                        <p class="fs-5">de 10</p>
                    </div>
                    <span class="warning">Sua loja consumiu 70% do limite.</span>
                </div>
            </div>
        </div>
    </div>
    <div class="card__box shop__info col-sm-4 grid">
        <div class="card grid">
            <div class="card__header">
                <h3 class="title">Ciclo do Cartão</h3>
                <a href="#" class="link">Alterar Plano</a>
            </div>
            <div class="plan__metrics">
                <div class="chart-js">
                    <svg xmlns="http://www.w3.org/2000/svg" width="96" height="96" viewBox="0 0 80 80" fill="none"><path d="M11.7157 68.2843C16.3671 72.9356 22.0938 76.3681 28.3886 78.2776C34.6834 80.1871 41.352 80.5147 47.8036 79.2314C54.2553 77.9481 60.2908 75.0935 65.3757 70.9204C70.4606 66.7474 74.4379 61.3847 76.9552 55.3073C79.4725 49.23 80.4521 42.6257 79.8074 36.0793C79.1626 29.533 76.9133 23.2466 73.2588 17.7772C69.6042 12.3078 64.6572 7.82402 58.8559 4.72315C53.0546 1.62228 46.578 4.96628e-07 40 0L40 40L11.7157 68.2843Z" fill="#01C89B"/><rect x="17.1429" y="17.1429" width="45.7143" height="45.7143" rx="22.8571" fill="white"/><rect x="9.28564" y="53.8571" width="17.1429" height="17.1429" rx="8.57143" fill="#01C89B"/><rect x="31" width="17.1429" height="17.1429" rx="8.57143" fill="#01C89B"/></svg>
                </div>
                <div class="text line-height">
                    <h4 class="fw-semibold mb-0">19 dias</h4>
                    <p class="fs-6">para finalizar o ciclo</p>
                    <span class="warning">Seu plano Grátis será renovado automaticamente.</span>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="card__container row">
    <div class="card__box shop__info col-sm-8 grid">
        <div class="card grid">
            <div class="card__header">
                <h3 class="title">Acessos</h3>
                <a href="#" class="link">Ver Mais</a>
            </div>
            <div class="shop__details">
                <p class="text-light">ACESSOS NO MÊS</p>
                <div class="details__content danger">
                    <h1>2451</h1>
                    <div class="shop__metrics">
                        <span class="percent danger">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" style="fill: rgba(0, 0, 0, 1);transform: ;msFilter:;"><path d="m14 9.586-4 4-6.293-6.293-1.414 1.414L10 16.414l4-4 4.293 4.293L16 19h6v-6l-2.293 2.293z"></path></svg>
                            19,2%
                        </span>
                        <p>Menos que mês passado</p>
                    </div>
                </div>
                <div class="chart-js">
                    <img src="<?php echo INCLUDE_PATH_DASHBOARD; ?>assets/images/Chart.svg" alt="Gráfico">
                </div>
            </div>
        </div>
    </div>
    <div class="card__box top__products col-sm-4 grid">
        <div class="card grid">
            <div class="card__header">
                <h5 class="fw-semibold mb-0">
                    TOP Produtos
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" style="fill: rgba(0, 0, 0, 1);transform: ;msFilter:;"><path d="M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zm0 18c-4.411 0-8-3.589-8-8s3.589-8 8-8 8 3.589 8 8-3.589 8-8 8z"></path><path d="M11 11h2v6h-2zm0-4h2v2h-2z"></path></svg>
                </h5>
                <a href="#" class="link">Ver Mais</a>
            </div>
        </div>
    </div>
</div>

<div class="card__container grid one tabPanel" style="display: grid;">
    <div class="card__box grid">
        <div class="card table">
    <?php
        // Nome da tabela para a busca
        $tabela = 'tb_products';

        $sql = "SELECT * FROM $tabela WHERE shop_id = :shop_id ORDER BY id DESC";

        // Preparar e executar a consulta
        $stmt = $conn_pdo->prepare($sql);
        $stmt->bindParam(':shop_id', $id);
        $stmt->execute();

        $countProduct = $stmt->rowCount();

        if ($stmt->rowCount() > 0) {
    ?>
            <table>
                <thead>
                    <tr>
                        <th>
                            <input type="checkbox" class="form-check-input" id="checkAll">
                        </th>
                        <th class="small">Nome</th>
                        <th class="small">Valor</th>
                        <th class="small">Categoria</th>
                        <th class="small">SKU</th>
                        <th class="small">Data de Criação</th>
                        <th class="small">Eventos</th>
                    </tr>
                </thead>
                <?php
                // Nome da tabela para a busca
                $tabela = 'tb_products';

                $sql = "SELECT * FROM $tabela WHERE shop_id = :shop_id ORDER BY id DESC";

                // Preparar e executar a consulta
                $stmt = $conn_pdo->prepare($sql);
                $stmt->bindParam(':shop_id', $id);
                $stmt->execute();

                // Recuperar os resultados
                $resultados = $stmt->fetchAll(PDO::FETCH_ASSOC);

                // Loop através dos resultados e exibir todas as colunas
                foreach ($resultados as $usuario) {
                    //Formatacao preco
                    // $price = str_replace(',', '.', str_replace('.', '', $usuario['price']));
                    $preco = $usuario['price'];

                    // Transforma o número no formato "R$ 149,90"
                    $price = "R$ " . number_format($preco, 2, ",", ".");

                    //Formatacao para data
                    $date_create = date("d/m/Y", strtotime($usuario['date_create']));

                    echo '
                        <tbody>
                            <tr>
                                <td scope="row">
                                    <input class="form-check-input itemCheckbox" type="checkbox" name="selected_ids[]" value="' . $usuario['id'] . '" id="defaultCheck2">
                                </td>
                                <td>
                    ';

                    // Consulta SQL para selecionar todas as colunas com base no ID
                    $sql = "SELECT * FROM imagens WHERE usuario_id = :usuario_id ORDER BY id ASC LIMIT 1";

                    // Preparar e executar a consulta
                    $stmt = $conn_pdo->prepare($sql);
                    $stmt->bindParam(':usuario_id', $usuario['id']);
                    $stmt->execute();

                    // Recuperar os resultados
                    $imagens = $stmt->fetchAll(PDO::FETCH_ASSOC);

                    // Loop através dos resultados e exibir todas as colunas
                    foreach ($imagens as $imagem) {
                        echo '<img src="' . INCLUDE_PATH_DASHBOARD . 'back-end/imagens/' . $imagem['usuario_id'] . '/' . $imagem['nome_imagem'] . '" alt="Capa do Produto" style="width: 38px; height: 38px; object-fit: cover;">';
                    }
                    
                    echo '
                                    ' . $usuario['name'] . '
                                </td>
                                <td>' . $price . '</td>
                                <td>' . $usuario['categories'] . '</td>
                                <td>' . $usuario['sku'] . '</td>
                                <td>' . $date_create . '</td>
                                <td>
                                    <a href="' . INCLUDE_PATH_DASHBOARD . 'editar-produto?id=' . $usuario['id'] . '" class="btn btn-primary">
                                        <i class="bx bx-show-alt" ></i>
                                    </a>
                                    <a href="' . INCLUDE_PATH_DASHBOARD . 'excluir-produto?id=' . $usuario['id'] . '" class="btn btn-danger">
                                        <i class="bx bxs-trash" ></i>
                                    </a>
                                </td>
                            </tr>
                        </tbody>
                    ';
                }
            ?>
            </table>
        </div>
        <?php
            } else {
                echo '
                        <div class="p-2 text-center">
                            <i class="bx bx-package" style="font-size: 3.5rem;"></i>
                            <p class="fw-semibold mb-4">Você não possui nenhum produto ativo!</p>
                            <a href="' . INCLUDE_PATH_DASHBOARD . 'criar-produto" class="btn btn-success btn-create-product text-decoration-none">+ Criar Produto</a>
                        </div>
                    ';
            }
        ?>
    </div>
</div>